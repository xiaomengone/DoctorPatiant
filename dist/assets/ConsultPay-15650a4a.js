import{_ as X}from"./CpIcon-85f3193e.js";import{_ as Y}from"./ReNavBar-c95b3280.js";import{_ as Z}from"./avatar-doctor-ce251225.js";import{d as L,c as e,m as ee,C as te,r as m,v as ne,i as ae,j as oe,D as se,o as U,e as G,f as i,t as R,w as p,q as le,h as V,p as ce,l as ie,_ as re}from"./index-91c59e71.js";import{c as ue,d as de,e as pe,f as me}from"./rapidConsultation-b5d3bd31.js";import{C as _e,S as ve}from"./index-fc11a3ea.js";import{c as E,e as fe,t as B,f as be,d as D,h as ye,I as F,H as he,w as H,m as ge}from"./index-5d8f6571.js";import{B as K}from"./index-2daf35a5.js";import{u as Ce}from"./use-placeholder-ecf850e8.js";import{p as Pe,b as xe,P as ke,L as Ie,s as Se}from"./request-3cf2d5e2.js";import{s as we}from"./function-call-c7bd6051.js";import{C as Be}from"./index-8ee7318d.js";import{C as Te}from"./index-61817de6.js";import"./use-route-956230c9.js";const[Ae,u]=E("action-sheet"),$e=fe({},Pe,{title:String,round:B,actions:be(),closeIcon:D("cross"),closeable:B,cancelText:String,description:String,closeOnPopstate:B,closeOnClickAction:Boolean,safeAreaInsetBottom:B}),De=[...xe,"round","closeOnPopstate","safeAreaInsetBottom"];var Le=L({name:Ae,props:$e,emits:["select","cancel","update:show"],setup(n,{slots:a,emit:s}){const b=t=>s("update:show",t),k=()=>{b(!1),s("cancel")},c=()=>{if(n.title)return e("div",{class:u("header")},[n.title,n.closeable&&e(F,{name:n.closeIcon,class:[u("close"),he],onClick:k},null)])},_=()=>{if(a.cancel||n.cancelText)return[e("div",{class:u("gap")},null),e("button",{type:"button",class:u("cancel"),onClick:k},[a.cancel?a.cancel():n.cancelText])]},g=(t,o)=>t.loading?e(Ie,{class:u("loading-icon")},null):a.action?a.action({action:t,index:o}):[e("span",{class:u("name")},[t.name]),t.subname&&e("div",{class:u("subname")},[t.subname])],C=(t,o)=>{const{color:y,loading:f,callback:h,disabled:P,className:I}=t,S=()=>{P||f||(h&&h(t),n.closeOnClickAction&&b(!1),te(()=>s("select",t,o)))};return e("button",{type:"button",style:{color:y},class:[u("item",{loading:f,disabled:P}),I],onClick:S},[g(t,o)])},v=()=>{if(n.description||a.description){const t=a.description?a.description():n.description;return e("div",{class:u("description")},[t])}};return()=>e(ke,ee({class:u(),position:"bottom","onUpdate:show":b},ye(n,De)),{default:()=>{var t;return[c(),v(),e("div",{class:u("content")},[n.actions.map(C),(t=a.default)==null?void 0:t.call(a)]),_()]}})}});const Me=H(Le),[Ne,d,Oe]=E("submit-bar"),Ue={tip:String,label:String,price:Number,tipIcon:String,loading:Boolean,currency:D("¥"),disabled:Boolean,textAlign:String,buttonText:String,buttonType:D("danger"),buttonColor:String,suffixLabel:String,placeholder:Boolean,decimalLength:ge(2),safeAreaInsetBottom:B};var Ge=L({name:Ne,props:Ue,emits:["submit"],setup(n,{emit:a,slots:s}){const b=m(),k=Ce(b,d),c=()=>{const{price:t,label:o,currency:y,textAlign:f,suffixLabel:h,decimalLength:P}=n;if(typeof t=="number"){const I=(t/100).toFixed(+P).split("."),S=P?`.${I[1]}`:"";return e("div",{class:d("text"),style:{textAlign:f}},[e("span",null,[o||Oe("label")]),e("span",{class:d("price")},[y,e("span",{class:d("price-integer")},[I[0]]),S]),h&&e("span",{class:d("suffix-label")},[h])])}},_=()=>{var t;const{tip:o,tipIcon:y}=n;if(s.tip||o)return e("div",{class:d("tip")},[y&&e(F,{class:d("tip-icon"),name:y},null),o&&e("span",{class:d("tip-text")},[o]),(t=s.tip)==null?void 0:t.call(s)])},g=()=>a("submit"),C=()=>s.button?s.button():e(K,{round:!0,type:n.buttonType,text:n.buttonText,class:d("button",n.buttonType),color:n.buttonColor,loading:n.loading,disabled:n.disabled,onClick:g},null),v=()=>{var t,o;return e("div",{ref:b,class:[d(),{"van-safe-area-bottom":n.safeAreaInsetBottom}]},[(t=s.top)==null?void 0:t.call(s),_(),e("div",{class:d("bar")},[(o=s.default)==null?void 0:o.call(s),c(),C()])])};return()=>n.placeholder?k(v):v()}});const Re=H(Ge),T=n=>(ce("data-v-e5580553"),n=n(),ie(),n),Ve={key:0,class:"consult-pay-page"},Ee={class:"pay-info"},Fe={class:"tit"},He=T(()=>i("img",{class:"img",src:Z},null,-1)),Ke=T(()=>i("p",{class:"desc"},[i("span",null,"极速问诊"),i("span",null,"自动分配医生")],-1)),qe=T(()=>i("div",{class:"pay-space"},null,-1)),je={class:"pay-schema"},ze=T(()=>i("span",{class:"text"},"支付协议",-1)),Je={class:"pay-type"},Qe={class:"amount"},We={class:"btn"},Xe={key:1},Ye=L({__name:"ConsultPay",setup(n){const a=ne(),{type:s,illnessType:b}=a.patientInformation,k=m({type:s||1,illnessType:b||1}),c=m(),_=m(),g=m(!1),C=m(!1),v=m(),t=m(1),o=m(),y=ae(),f=m({orderId:"",paymentMethod:1,payCallback:""}),h=window.location.host,P=async r=>{const l=await ue(r);c.value=l.data,a.patientInformation.couponId=l.data.couponId},I=async r=>{const l=await de(r);_.value=l.data},S=async()=>{if(console.log("originalURL",h),g.value){C.value=!0;const r=await pe(a.patientInformation);v.value=r.data.id,a.deletePatientInformation(),f.value.orderId=v.value,f.value.payCallback=`http:${h}/DoctorPatiant/dist/consult/room`,f.value.paymentMethod=t.value||1}else Se("请勾选用户协议")},q=()=>{we({title:"温馨提示",message:"取消支付将无法获得医生回复，医生接诊名额有限，是否确认关闭？",cancelButtonText:"狠心离开",confirmButtonText:"继续支付"}).then(()=>!1).catch(()=>(v.value="",y.push("/user/consult"),!0))},j=()=>{me(f.value).then(r=>{o.value=r.data.payUrl,window.location.href=o.value})};return oe(()=>{var r;P(k.value),I(((r=a.patientInformation)==null?void 0:r.patientId)||"")}),se(()=>{if(v.value)return!1}),(r,l)=>{var O;const M=Y,x=Te,A=_e,$=Be,z=Re,N=X,J=K,Q=Me,W=ve;return c.value&&_.value?(U(),G("div",Ve,[e(M,{title:"支付"}),i("div",Ee,[i("p",Fe,"图文问诊 "+R((O=c.value)==null?void 0:O.payment)+" 元",1),He,Ke]),e(A,null,{default:p(()=>[e(x,{title:"优惠券",value:`-¥${c.value.couponDeduction}`},null,8,["value"]),e(x,{title:"积分抵扣",value:`-¥${c.value.pointDeduction}`},null,8,["value"]),e(x,{title:"实付款",value:`¥${c.value.actualPayment}`,class:"pay-price"},null,8,["value"])]),_:1}),qe,e(A,null,{default:p(()=>[e(x,{title:"患者信息",value:`${_.value.name} | ${_.value.gender==0?"男":"女"} | ${_.value.age}岁`},null,8,["value"]),e(x,{title:"病情描述",label:le(a).patientInformation.illnessDesc},null,8,["label"])]),_:1}),i("div",je,[e($,{modelValue:g.value,"onUpdate:modelValue":l[0]||(l[0]=w=>g.value=w)},{default:p(()=>[V("我已同意 "),ze]),_:1},8,["modelValue"])]),e(z,{"button-type":"primary",price:c.value.actualPayment*100,"button-text":"立即支付","text-align":"left",onClick:S},null,8,["price"]),e(Q,{show:C.value,"onUpdate:show":l[3]||(l[3]=w=>C.value=w),title:"选择支付方式",closeable:!1,"close-on-popstate":!1,"before-close":q},{default:p(()=>[i("div",Je,[i("p",Qe,"￥"+R(c.value.actualPayment.toFixed(2)),1),e(A,null,{default:p(()=>[e(x,{title:"微信支付",onClick:l[1]||(l[1]=w=>t.value=0)},{icon:p(()=>[e(N,{name:"consult-wechat"})]),extra:p(()=>[e($,{checked:t.value===0},null,8,["checked"])]),_:1}),e(x,{title:"支付宝支付",onClick:l[2]||(l[2]=w=>t.value=1)},{icon:p(()=>[e(N,{name:"consult-alipay"})]),extra:p(()=>[e($,{checked:t.value===1},null,8,["checked"])]),_:1})]),_:1}),i("div",We,[e(J,{type:"primary",round:"",block:"",onClick:j},{default:p(()=>[V("立即支付")]),_:1})])])]),_:1},8,["show"])])):(U(),G("div",Xe,[e(M,{title:"支付"}),e(W,{title:"",row:8})]))}}});const mt=re(Ye,[["__scopeId","data-v-e5580553"]]);export{mt as default};
