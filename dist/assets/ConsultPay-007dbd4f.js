import{_ as W}from"./CpIcon-a1db815b.js";import{_ as X}from"./ReNavBar-364281e2.js";import{_ as Y}from"./avatar-doctor-ce251225.js";import{d as N,c as e,m as Z,B as ee,r as m,s as te,i as ne,j as ae,C as oe,e as G,f as i,t as V,w as p,o as U,n as se,h as R,p as le,l as ce,_ as ie}from"./index-c9fc3956.js";import{c as re,d as ue,e as de,f as pe}from"./rapidConsultation-e477c24b.js";import{C as me,S as _e}from"./index-9aff979e.js";import{c as E,e as ve,t as B,f as fe,d as M,h as be,I as F,H as he,w as H,m as ye}from"./index-6575b4f2.js";import{B as K}from"./index-54e0b0f2.js";import{u as ge}from"./use-placeholder-9f9a0586.js";import{p as Ce,b as Pe,P as xe,L as ke,s as Ie}from"./request-cc1ff509.js";import{s as Se}from"./function-call-07b3dde8.js";import{C as we}from"./index-e246558c.js";import{C as Be}from"./index-7d852fbe.js";import"./use-route-c0dbeb7e.js";const[Te,u]=E("action-sheet"),Ae=ve({},Ce,{title:String,round:B,actions:fe(),closeIcon:M("cross"),closeable:B,cancelText:String,description:String,closeOnPopstate:B,closeOnClickAction:Boolean,safeAreaInsetBottom:B}),$e=[...Pe,"round","closeOnPopstate","safeAreaInsetBottom"];var Me=N({name:Te,props:Ae,emits:["select","cancel","update:show"],setup(n,{slots:a,emit:s}){const b=t=>s("update:show",t),k=()=>{b(!1),s("cancel")},c=()=>{if(n.title)return e("div",{class:u("header")},[n.title,n.closeable&&e(F,{name:n.closeIcon,class:[u("close"),he],onClick:k},null)])},_=()=>{if(a.cancel||n.cancelText)return[e("div",{class:u("gap")},null),e("button",{type:"button",class:u("cancel"),onClick:k},[a.cancel?a.cancel():n.cancelText])]},y=(t,o)=>t.loading?e(ke,{class:u("loading-icon")},null):a.action?a.action({action:t,index:o}):[e("span",{class:u("name")},[t.name]),t.subname&&e("div",{class:u("subname")},[t.subname])],g=(t,o)=>{const{color:h,loading:f,callback:C,disabled:P,className:I}=t,S=()=>{P||f||(C&&C(t),n.closeOnClickAction&&b(!1),ee(()=>s("select",t,o)))};return e("button",{type:"button",style:{color:h},class:[u("item",{loading:f,disabled:P}),I],onClick:S},[y(t,o)])},v=()=>{if(n.description||a.description){const t=a.description?a.description():n.description;return e("div",{class:u("description")},[t])}};return()=>e(xe,Z({class:u(),position:"bottom","onUpdate:show":b},be(n,$e)),{default:()=>{var t;return[c(),v(),e("div",{class:u("content")},[n.actions.map(g),(t=a.default)==null?void 0:t.call(a)]),_()]}})}});const Ne=H(Me),[Oe,d,De]=E("submit-bar"),Le={tip:String,label:String,price:Number,tipIcon:String,loading:Boolean,currency:M("¥"),disabled:Boolean,textAlign:String,buttonText:String,buttonType:M("danger"),buttonColor:String,suffixLabel:String,placeholder:Boolean,decimalLength:ye(2),safeAreaInsetBottom:B};var Ge=N({name:Oe,props:Le,emits:["submit"],setup(n,{emit:a,slots:s}){const b=m(),k=ge(b,d),c=()=>{const{price:t,label:o,currency:h,textAlign:f,suffixLabel:C,decimalLength:P}=n;if(typeof t=="number"){const I=(t/100).toFixed(+P).split("."),S=P?`.${I[1]}`:"";return e("div",{class:d("text"),style:{textAlign:f}},[e("span",null,[o||De("label")]),e("span",{class:d("price")},[h,e("span",{class:d("price-integer")},[I[0]]),S]),C&&e("span",{class:d("suffix-label")},[C])])}},_=()=>{var t;const{tip:o,tipIcon:h}=n;if(s.tip||o)return e("div",{class:d("tip")},[h&&e(F,{class:d("tip-icon"),name:h},null),o&&e("span",{class:d("tip-text")},[o]),(t=s.tip)==null?void 0:t.call(s)])},y=()=>a("submit"),g=()=>s.button?s.button():e(K,{round:!0,type:n.buttonType,text:n.buttonText,class:d("button",n.buttonType),color:n.buttonColor,loading:n.loading,disabled:n.disabled,onClick:y},null),v=()=>{var t,o;return e("div",{ref:b,class:[d(),{"van-safe-area-bottom":n.safeAreaInsetBottom}]},[(t=s.top)==null?void 0:t.call(s),_(),e("div",{class:d("bar")},[(o=s.default)==null?void 0:o.call(s),c(),g()])])};return()=>n.placeholder?k(v):v()}});const Ve=H(Ge),T=n=>(le("data-v-3b28d648"),n=n(),ce(),n),Ue={key:0,class:"consult-pay-page"},Re={class:"pay-info"},Ee={class:"tit"},Fe=T(()=>i("img",{class:"img",src:Y},null,-1)),He=T(()=>i("p",{class:"desc"},[i("span",null,"极速问诊"),i("span",null,"自动分配医生")],-1)),Ke=T(()=>i("div",{class:"pay-space"},null,-1)),je={class:"pay-schema"},qe=T(()=>i("span",{class:"text"},"支付协议",-1)),ze={class:"pay-type"},Je={class:"amount"},Qe={class:"btn"},We={key:1},Xe=N({__name:"ConsultPay",setup(n){const a=te(),{type:s,illnessType:b}=a.patientInformation,k=m({type:s||1,illnessType:b||1}),c=m(),_=m(),y=m(!1),g=m(!1),v=m(),t=m(1),o=m(),h=ne(),f=m({orderId:"",paymentMethod:1,payCallback:""}),C=async r=>{const l=await re(r);c.value=l.data,a.patientInformation.couponId=l.data.couponId},P=async r=>{const l=await ue(r);_.value=l.data},I=async()=>{if(y.value){g.value=!0;const r=await de(a.patientInformation);v.value=r.data.id,a.deletePatientInformation(),f.value.orderId=v.value,f.value.payCallback="https://cp.itheima.net/consult/room",f.value.paymentMethod=t.value||1,console.log("location.host",window.location.host)}else Ie("请勾选用户协议")},S=()=>{Se({title:"温馨提示",message:"取消支付将无法获得医生回复，医生接诊名额有限，是否确认关闭？",cancelButtonText:"狠心离开",confirmButtonText:"继续支付"}).then(()=>!1).catch(()=>(v.value="",h.push("/user/consult"),!0))},j=()=>{pe(f.value).then(r=>{o.value=r.data.payUrl,window.location.href=o.value})};return ae(()=>{var r;C(k.value),P(((r=a.patientInformation)==null?void 0:r.patientId)||"")}),oe(()=>{if(v.value)return!1}),(r,l)=>{var L;const O=X,x=Be,A=me,$=we,q=Ve,D=W,z=K,J=Ne,Q=_e;return c.value&&_.value?(U(),G("div",Ue,[e(O,{title:"支付"}),i("div",Re,[i("p",Ee,"图文问诊 "+V((L=c.value)==null?void 0:L.payment)+" 元",1),Fe,He]),e(A,null,{default:p(()=>[e(x,{title:"优惠券",value:`-¥${c.value.couponDeduction}`},null,8,["value"]),e(x,{title:"积分抵扣",value:`-¥${c.value.pointDeduction}`},null,8,["value"]),e(x,{title:"实付款",value:`¥${c.value.actualPayment}`,class:"pay-price"},null,8,["value"])]),_:1}),Ke,e(A,null,{default:p(()=>[e(x,{title:"患者信息",value:`${_.value.name} | ${_.value.gender==0?"男":"女"} | ${_.value.age}岁`},null,8,["value"]),e(x,{title:"病情描述",label:se(a).patientInformation.illnessDesc},null,8,["label"])]),_:1}),i("div",je,[e($,{modelValue:y.value,"onUpdate:modelValue":l[0]||(l[0]=w=>y.value=w)},{default:p(()=>[R("我已同意 "),qe]),_:1},8,["modelValue"])]),e(q,{"button-type":"primary",price:c.value.actualPayment*100,"button-text":"立即支付","text-align":"left",onClick:I},null,8,["price"]),e(J,{show:g.value,"onUpdate:show":l[3]||(l[3]=w=>g.value=w),title:"选择支付方式",closeable:!1,"close-on-popstate":!1,"before-close":S},{default:p(()=>[i("div",ze,[i("p",Je,"￥"+V(c.value.actualPayment.toFixed(2)),1),e(A,null,{default:p(()=>[e(x,{title:"微信支付",onClick:l[1]||(l[1]=w=>t.value=0)},{icon:p(()=>[e(D,{name:"consult-wechat"})]),extra:p(()=>[e($,{checked:t.value===0},null,8,["checked"])]),_:1}),e(x,{title:"支付宝支付",onClick:l[2]||(l[2]=w=>t.value=1)},{icon:p(()=>[e(D,{name:"consult-alipay"})]),extra:p(()=>[e($,{checked:t.value===1},null,8,["checked"])]),_:1})]),_:1}),i("div",Qe,[e(z,{type:"primary",round:"",block:"",onClick:j},{default:p(()=>[R("立即支付")]),_:1})])])]),_:1},8,["show"])])):(U(),G("div",We,[e(O,{title:"支付"}),e(Q,{title:"",row:8})]))}}});const pt=ie(Xe,[["__scopeId","data-v-3b28d648"]]);export{pt as default};
