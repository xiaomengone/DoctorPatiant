import{_ as Q}from"./CpRadioBtn-a82742d9.js";import{_ as W}from"./CpIcon-1d91d892.js";import{_ as X}from"./ReNavBar-3134af6b.js";import{d as Y,r as u,v as Z,s as ee,i as te,a as A,j as ae,e as d,c as a,z as _,f as l,F as oe,k as se,w as r,o as i,y as le,t as C,A as ne,h as I,n as R,q as ie,p as ue,l as de,_ as re}from"./index-a79e0a92.js";import{e as ce,f as pe,g as _e,h as me}from"./user-605aa103.js";import{r as ve,a as fe,F as ge}from"./rules-ebe4e046.js";import{P as he,s as N}from"./request-9531ed09.js";import{a as M,A as Ce,b as ke}from"./function-call-34ff397d.js";import"./index-5655da47.js";import{B as ye}from"./index-32f48f10.js";import{F as Fe}from"./index-ee595e2a.js";import{C as be}from"./index-388b4b3e.js";import"./use-placeholder-e680c5e2.js";import"./index-1ce8ca7a.js";import"./use-route-0453f8f5.js";import"./index-e7b2194d.js";import"./use-id-5571225d.js";const k=m=>(ue("data-v-8d1f0825"),m=m(),de(),m),Ve={class:"patient-page"},we={key:0,class:"patient-change"},Pe=k(()=>l("h3",null,"请选择患者信息",-1)),xe=k(()=>l("p",null,"以便医生给出更准确的治疗，信息仅医生可见",-1)),Be=[Pe,xe],Ae={class:"patient-list"},Ie=["onClick"],Re={class:"info"},Ne={class:"name"},Me={class:"id"},Se={class:"icon"},Ue={key:0,class:"tag"},$e={key:0,class:"patient-add"},Le=k(()=>l("p",null,"添加患者",-1)),ze=k(()=>l("div",{class:"patient-tip"},"最多可添加 6 人",-1)),De={key:1,class:"patient-next"},Te=Y({__name:"FamilyArchives",setup(m){const v=u(),n=u(!1),S=[{label:"男",value:1},{label:"女",value:0}];u(0);const w={name:"",idCard:"",defaultFlag:0,gender:1},e=u({...w}),y=u(),U=Z();u(!1);const p=u(),$=ee(),L=te(),f=async()=>{const s=await ce();v.value=s.data,p.value||(p.value=v.value[0].id)},P=s=>{var o;if(s){n.value=!0;const{name:g,idCard:h,defaultFlag:b,gender:c,id:V}=s;e.value={name:g,idCard:h,defaultFlag:b,gender:c,id:V}}else n.value=!0,e.value={name:" ",idCard:" ",defaultFlag:0,gender:1,id:" "},(o=y.value)==null||o.resetValidation()},z=()=>{n.value=!1},D=async()=>{var s;if(await((s=y.value)==null?void 0:s.validate()),+e.value.idCard.slice(-2,-1)%2!==e.value.gender)return N("请选择正确的性别");e.value.id?(await pe(e.value),n.value=!1,M({title:"温馨提示",message:"成功修改信息"}).then(()=>{f()})):(e.value.defaultFlag=w.defaultFlag,await _e(e.value),n.value=!1,M({title:"温馨提示",message:"添加成功"}).then(()=>{f()}))},T=async()=>{await me(e.value.id),n.value=!1,N("删除成功"),f()},q=s=>{p.value=s.id},E=()=>{$.setPatiantId(p.value||""),L.push("/consult/consultPay")},x=A({get:()=>e.value.defaultFlag==1,set:s=>e.value.defaultFlag=s?1:0});ae(()=>{f()});const F=A(()=>!!U.query.isChange);return(s,o)=>{var B;const g=X,h=W,b=ye,c=Fe,V=Q,j=be,G=ge,H=Ce,J=ke,K=he;return i(),d("div",Ve,[a(g,{title:F.value?"选择患者":"家庭档案"},null,8,["title"]),F.value?(i(),d("div",we,Be)):_("",!0),l("div",Ae,[(i(!0),d(oe,null,se(v.value,t=>(i(),d("div",{class:le(["patient-item",{selected:t.id==p.value}]),key:t.id,onClick:O=>q(t)},[l("div",Re,[l("span",Ne,C(t.name),1),l("span",Me,C(t.idCard.replace(/^(.{6}).+(.{4})$/,"$1********$2")),1),l("span",null,C(t.gender),1),l("span",null,C(t.age)+"岁",1)]),l("div",Se,[a(h,{name:"user-edit",onClick:ne(O=>P(t),["stop"])},null,8,["onClick"])]),t.defaultFlag?(i(),d("div",Ue,"默认")):_("",!0)],10,Ie))),128)),((B=v.value)==null?void 0:B.length)<6?(i(),d("div",$e,[a(h,{name:"user-add",onClick:P}),Le])):_("",!0),ze]),F.value?(i(),d("div",De,[a(b,{type:"primary",round:"",block:"",onClick:E},{default:r(()=>[I("下一步")]),_:1})])):_("",!0),a(K,{show:n.value,"onUpdate:show":o[4]||(o[4]=t=>n.value=t),position:"right",style:{width:"90%",height:"100%"}},{default:r(()=>[a(g,{title:e.value.id?"修改信息":"添加患者",rightText:"保存",back:z,onNavClickRight:D},null,8,["title"]),a(G,{autocomplete:"off",ref_key:"form",ref:y},{default:r(()=>[a(c,{label:"真实姓名",placeholder:"请输入真实姓名",modelValue:e.value.name,"onUpdate:modelValue":o[0]||(o[0]=t=>e.value.name=t),rules:R(ve)},null,8,["modelValue","rules"]),a(c,{label:"身份证号",placeholder:"请输入身份证号",modelValue:e.value.idCard,"onUpdate:modelValue":o[1]||(o[1]=t=>e.value.idCard=t),rules:R(fe)},null,8,["modelValue","rules"]),a(c,{label:"性别",class:"pb4"},{input:r(()=>[a(V,{optionList:S,modelValue:e.value.gender,"onUpdate:modelValue":o[2]||(o[2]=t=>e.value.gender=t)},null,8,["modelValue"])]),_:1}),a(c,{label:"默认就诊人"},{input:r(()=>[a(j,{"icon-size":18,round:"",modelValue:x.value,"onUpdate:modelValue":o[3]||(o[3]=t=>x.value=t)},null,8,["modelValue"])]),_:1})]),_:1},512),e.value.id?(i(),ie(J,{key:0},{default:r(()=>[a(H,{onClick:T},{default:r(()=>[I("删除")]),_:1})]),_:1})):_("",!0)]),_:1},8,["show"])])}}});const st=re(Te,[["__scopeId","data-v-8d1f0825"]]);export{st as default};
